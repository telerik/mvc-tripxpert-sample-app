@{
    ViewBag.Title = "Home Page";
}
<div class="t-row tx_search tx_clearfix col-xs-12">
    <div class="col-xs-12 col-sm-3">
        <span class="k-icon k-i-marker-pin"></span>
        <span class="searchbox-wrapper">
            @*The label is needed for accessibility https://docs.telerik.com/kendo-ui/accessibility/section-508#label-element-support*@
            <label style="margin-bottom:0;width: 100%;">
                @(Html.Kendo().ComboBox()
                        .Name("Destinations") //The name of the ComboBox is mandatory. It specifies the "id" attribute of the widget.
                        .Placeholder("All types")
                        .DataTextField("Title") //Specify which property of the Product to be used by the ComboBox as a text.
                        .Filter("contains")
                        .HtmlAttributes(new { style = "width: 100%" })
                        .DataSource(source =>
                        {
                            source.Read(read =>
                            {
                                read.Action("GetDestinations", "Home"); //Set the Action and Controller names.
                            });
                        })
                        .Events(ev => ev.Select("destinationsSelect").Change("destinationsChange"))
                        .Height(442)
                        .Template(@"<div class='destination-combo-template clearfix'>
                        <span class='tx_icon tx_left_arrow_icon'></span><img src='#=data.DefaultImage#' title='#=data.Title#' /><h4>#=data.Title#</h4>
                        <span>#=getRating(data.Rating)#</span>
                        <span class='info'>from #:kendo.toString(data.LowestPrice, 'c0')#</span></div>
                        ")
                )
            </label>
        </span>
    </div>
    <div class="col-sm-3">
        <span class="k-icon k-i-bell"></span>
        <span class="searchbox-wrapper">
            @(Html.Kendo().DropDownList()
                .Name("OfferType")
                .OptionLabel("Select offer type")
                .DataTextField("Text")
                .DataValueField("Value")
                .BindTo(new List<SelectListItem>() {
                          new SelectListItem() {
                            Text = "All types", Value = "All"
                          },
                          new SelectListItem() {
                            Text = "Special offers", Value = "Special"
                          },
                          new SelectListItem() {
                            Text = "Regular offers", Value = "Regular"
                          }
                })
                .HtmlAttributes(new { style = "width:100%;" })
                .Height(150)
            )
        </span>
    </div>
    <div class="col-sm-3">
        <span class="k-icon k-i-currency"></span>
        <span class="searchbox-wrapper">
            <input id="PriceRange" type="hidden" />

            <span class="k-price-range-slider-wrapper">
                @(Html.Kendo().RangeSlider()
                 .Name("PriceRangeSlider")
                 .Min(0)
                 .Max(3000)
                 .SmallStep(100)
                 .LargeStep(1000)
                 .Events(events => events
                     .Change("priceRangeSliderChange"))
                 .Deferred()
                )
            </span>

            <span class="k-price-range-drop-down-wrapper">
                @(Html.Kendo().DropDownList()
                    .Name("PriceRangeDropDown")
                    .OptionLabel("Select price range")
                    .DataTextField("Text")
                    .DataValueField("Value")
                    .BindTo(new List<SelectListItem>() {
                        new SelectListItem() {
                        Text = "Any price range", Value = "0"
                        },
                        new SelectListItem() {
                        Text = "from $0 to $999", Value = "0-999"
                        },
                        new SelectListItem() {
                        Text = "from $1000 to $1999", Value = "1000-1999"
                        },
                        new SelectListItem() {
                        Text = "from $2000 to $2999", Value = "2000-2999"
                        }
                    })
                    .HtmlAttributes(new { style = "width:100%;" })
                    .Height(150)
                    .Events(x => x.Change("priceRangeDropDownChange"))
                    .Deferred()
                )
            </span>

        </span>
    </div>
    <div class="col-sm-3 clearfix">
        @(Html.Kendo().Button()
                                .Name("SearchButton")
                                .HtmlAttributes(new { type = "button", @class = "k-primary col-sm-8 col-xs-12" })
                                .Content("Search")
                                .Events(ev => ev.Click("searchClick"))
        )
    </div>
</div>

<div class="main-background"></div>

<div class="row">
    <div class="recommends">
        <h2>Tripxpert Recommends</h2>
    </div>
    @(Html.Kendo().ListView<TripXpert.Models.DestinationViewModel>()
                    .Name("listView")
                    .TagName("div")
                    .ClientTemplateId("bootstrap-card-template")
                    .DataSource(dataSource =>
                    {
                        dataSource.Read(read => read.Action("Destinations_Read", "Destinations"));
                        dataSource.PageSize(3);
                    })
    )
</div>

<script type="text/x-kendo-tmpl" id="kendo-card-template">
    <div class="k-card k-card-type-rich">
        <img src="#:DefaultImage#" class="k-card-image" />
        <div class="k-card-body">
            <h5 class="k-card-title">#:Title#</h5>
            <h6 class="k-card-subtitle">
                # for (var i=0; i < data.ShortDescription.length; i++) {#
                    # if (i > 0) { #
                        <span class="tx_dot_separator" style="display: inline-block"></span>
                    #}#
                    #:data.ShortDescription[i]#
                #}#
            </h6>
        </div>
        <div class="k-card-actions">
            <span class="k-card-action" onclick="location.href='/Destination/#:DestinationID#'"><span class="k-button k-flat k-primary">View Details</span></span>
        </div>
    </div>
</script>


<div id="example" style="height: 100%">
    <div class="responsive-message"></div>
</div>
<script>

    var selectedID = "";
    var offerType = "";
    var priceRange = "";
    var ids = "1";

    function getRating(rating) {
        var count = Math.floor(rating);
        var result = "";
        for (var i = 0; i < count; i++) {
            result += "<span class='k-icon k-i-star'></span>";
        }
        return result;
    }
    function destinationsSelect(e) {
        selectedID = e.dataItem.DestinationID;
    }

    function destinationsChange(e) {
        if (e.sender.select() < 0) {
            selectedID = "";
        }
    }

    function searchClick() {
        $.ajax({
            url: '@Url.Action("GetDestinationsQuery","Home")',
            type: 'GET',
            data: {
                priceRange:  $("#PriceRange").val(),
                offerType: $("#OfferType").data("kendoDropDownList").value()
            },
            success: function (data) {
                data ? ids = data : ids = "1";
                ids = ids.split(',');
                if (selectedID != "") {
                    ids = selectedID;
                }
                if (ids.length > 1) {
                    window.location.href = '@Url.Action("Destinations","Destinations")' + "?Ids=" + ids.toString();
                }
                else {
                    window.location.href = '@Url.Action("DestinationDetails", "Destinations")' + "/" + ids.toString();;
                }
            }
        });

    }

    function priceRangeDropDownChange() {
        $("#PriceRange").val(this.value());
    }

    function priceRangeSliderChange(e) {
        $("#PriceRange").val(e.values.toString().replace(",", "-"));
    }

    $(function () {
         if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
            @Html.Kendo().DeferredScriptsFor("PriceRangeSlider", false)
            $('.k-price-range-slider-wrapper').show();
        } else {
            @Html.Kendo().DeferredScriptsFor("PriceRangeDropDown", false)
            $('.k-price-range-drop-down-wrapper').show();
        }

        dataSource = new kendo.data.DataSource({
            transport: {
                read: {
                    url: ('@Url.Action("GetSpecialDestinations")'),
                    dataType: "json"
                }
            }
        });
    });

    //Open on focus logic
    $(function () {
        $("[data-role=combobox]").each(function () {
            var widget = $(this).getKendoComboBox();
            widget.input.on("focus", function () {
                widget.open();
            });
        });
    });

    $(window).resize(function () {
        var destinationCombo = $("#Destinations").data("kendoComboBox");
        var priceDropDown = $("#PriceRangeDropDown").data("kendoDropDownList");
        var offerDropDown = $("#OfferType").data("kendoDropDownList");

        destinationCombo.close();
        priceDropDown? priceDropDown.close():'';
        offerDropDown.close();

        updateImage();
    });

    function updateImage() {
        var img = $(".image-wrapper img");
        var contHeight = img.closest(".image-wrapper").height();
        var contWidth = img.closest(".image-wrapper").width();
        var ratio1 = contWidth / contHeight;
        var ratio2 = 1.777;
        if (ratio2 > ratio1) {
            img.height(contHeight);
        }
        else {
            img.height( contWidth / ratio2);
        }
    }
</script>
<link rel="stylesheet" href="https://kendo.cdn.telerik.com/2018.1.221/styles/kendo.nova.mobile.min.css" />
<style>

    html, body, #wrapper, #main-content, .col-sm-12, .body-content, .demo-section {
        height: 100%;
    }

    .image-wrapper {
        height: 110%;
        overflow: hidden;
    }

        .image-wrapper img {
            display: inline-block;
            position: relative;
        }

    .k-virtual-page.km-virtual-page {
        width: 100% !important;
    }

        .k-virtual-page.km-virtual-page > div {
            height: 100% !important;
        }

    .main-background {
        background-image: url("/images/gallery/France%20-%20A%20Grand%20Tour/2000x1125/Eiffel-Tower_Attraction.jpg");
        height: 45%;
        width: 100%;
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center center;
    }

    .body-content .row {
        background-color: #F8F8F8;
    }

   .row #listView{
        padding-left:0;
        padding-top: 1rem;
        padding-bottom:5rem;
        display:flex;
        justify-content:space-evenly;     
        background-color: #F8F8F8;
    }

    .card-actions{
        display:flex;
        justify-content:space-between;
    }

    #listView .card{
        border-radius: 2px;
        background-color:#fff;
    }

    #listView .card .card-body{
        padding:2rem;
    }

    #listView .card .image-container{
        height:60%;
        background-size:cover;
        background-size: contain;
        background-repeat: no-repeat;
    }

 

    #listView .card:hover{
        box-shadow:0 10px 16px 0 rgba(0,0,0,0.2),0 6px 20px 0 rgba(0,0,0,0.19);
    }
    .recommends h2{
        text-align:center;
    }

    .k-price-range-drop-down-wrapper, .k-price-range-slider-wrapper{
        display:none;
    }

</style>
